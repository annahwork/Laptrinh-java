<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SC Staff | Quản lý Khách hàng</title>

    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/layout.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>

<body>
    <div class="app-layout">

        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h3>EV Warranty System</h3>

            </div>

            <nav class="sidebar-menu">
                <ul>
                    <li class="menu-group">
                        <button class="menu-group-toggle" type="button">
                            <i class="fas fa-layer-group fa-fw"></i>
                            <span>Quản lý hồ sơ</span>
                            <i class="fas fa-chevron-down group-arrow"></i>
                        </button>
                        <ul class="submenu">
                            <li><a href="vehicles.html"><i class="fas fa-car-side fa-fw"></i> Quản lý Xe</a></li>
                            <li><a href="customers.html" class="active"><i class="fas fa-users fa-fw"></i> Quản lý Khách
                                    hàng
                                </a></li>
                        </ul>
                    </li>

                    <li><a href="claims.html"><i class="fas fa-screwdriver-wrench fa-fw"></i> <span>Yêu cầu Bảo
                                hành</span></a></li>
                    <li><a href="dieu_phoi_ky_thuat_vien.html"><i class="fas fa-user-gear fa-fw"></i> <span>Điều phối Kỹ
                                thuật viên</span></a></li>
                    <li><a href="campaigns.html"><i class="fas fa-bullhorn fa-fw"></i> <span>Quản lý Chiến
                                dịch</span></a></li>
                    <li><a href="notifications.html"><i class="fas fa-bell fa-fw"></i> <span>Thông báo</span></a></li>
                </ul>
            </nav>

            <div class="sidebar-resizer" id="sidebarResizer"></div>
        </aside>

        <main class="content-wrapper" id="contentWrapper">
            <div class="content-header">
                <h1>Quản lý Khách hàng</h1>
            </div>

            <div class="main-content-area">
                <!-- Search + Add -->
                <div class="search-add-bar">
                    <div class="search-box-wrapper">
                        <i class="fas fa-search search-icon"></i>
                        <input type="text" class="form-control search-input-with-icon"
                            placeholder="Tìm kiếm theo tên, điện thoại, email...">
                    </div>
                    <button class="btn-primary" id="newCustomerBtn"><i class="fas fa-user-plus"></i> Thêm khách hàng
                    </button>
                </div>

                <!-- Filters (ví dụ) - UPDATED: remove source options list, add vehicle type filter -->
                <div class="card filter-card">
                    <div class="filter-card-body">
                        <div class="filter-controls">
                            <!-- keep only placeholder for source (no list) -->
                            <select id="sourceFilter" class="filter-select">
                                <option value="">Tất cả nguồn</option>
                            </select>

                            <!-- new: vehicle type filter -->
                            <select id="vehicleTypeFilter" class="filter-select">
                                <option value="">Tất cả loại xe</option>
                                <option value="Sedan">Sedan</option>
                                <option value="SUV">SUV</option>
                                <option value="Hatchback">Hatchback</option>
                                <option value="EV">EV</option>
                                <option value="Pickup">Pickup</option>
                            </select>

                            <select class="filter-select">
                                <option>Sắp xếp</option>
                                <option>Tên A-Z</option>
                                <option>Ngày tạo mới nhất</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Danh sách khách hàng -->
                <div class="card">
                    <div class="card-header">
                        <h3>Danh sách Khách hàng</h3>
                    </div>
                    <div class="card-body-no-padding">
                        <table class="table-zebra table-full-width">
                            <thead>
                                <tr class="table-header-row">
                                    <th class="table-header-cell">Tên</th>
                                    <th class="table-header-cell">Điện thoại</th>
                                    <th class="table-header-cell">Email</th>
                                    <th class="table-header-cell">Địa chỉ</th>
                                    <!-- NEW column: Loại xe -->
                                    <th class="table-header-cell">Loại xe</th>
                                    <th class="table-header-cell">Số xe</th>
                                    <th class="table-header-cell">Thao tác</th>
                                </tr>
                            </thead>
                            <tbody id="customersTbody">
                                <!-- Placeholder khi chưa có DB -->
                                <tr id="placeholderRow">
                                    <td colspan="7" class="table-placeholder-cell">
                                        Dữ liệu sẽ được load từ database — chưa có dữ liệu ở môi trường hiện tại.
                                    </td>
                                </tr>

                                <!--
								Ví dụ Thymeleaf khi có backend:
								<tr th:each="cust : ${customers}">
									<td th:text="${cust.fullName}">Nguyễn Văn A</td>
									<td th:text="${cust.phone}">0901234567</td>
									<td th:text="${cust.email}">a@example.com</td>
									<td th:text="${cust.address}">Hà Nội</td>
									<td th:text="${cust.vehicleCount}">2</td>
									<td>
										<button class="btn" onclick="openCustomerPopup(/* pass id */)">Xem</button>
									</td>
								</tr>
								-->
                            </tbody>
                        </table>
                    </div>
                    <div class="card-footer">
                        <div class="pagination-wrapper">
                            <span class="pagination-info">Hiển thị 0 của 0</span>
                            <div>
                                <button class="pagination-btn">« Trước</button>
                                <button class="btn-primary pagination-btn-active">1</button>
                                <button class="pagination-btn">2</button>
                                <button class="pagination-btn">Sau »</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Customer create modal (UPDATED: added vehicle fields) -->
                <div id="customerModal" class="modal modal-hidden">
                    <div class="modal-content" role="dialog" aria-modal="true" aria-labelledby="customerModalTitle"
                        tabindex="-1">
                        <div class="modal-header">
                            <h3 id="customerModalTitle">Thêm Khách hàng</h3>
                            <span class="modal-close" id="customerModalClose" role="button"
                                aria-label="Đóng">&times;</span>
                        </div>

                        <form id="customerForm">
                            <div class="modal-body">
                                <div class="form-group">
                                    <label class="form-label">Họ và tên</label>
                                    <input type="text" id="c_name" name="fullName" class="form-control" required>
                                </div>

                                <div class="form-group">
                                    <label class="form-label">Điện thoại</label>
                                    <input type="text" id="c_phone" name="phone" class="form-control">
                                </div>

                                <div class="form-group">
                                    <label class="form-label">Email</label>
                                    <input type="email" id="c_email" name="email" class="form-control">
                                </div>

                                <div class="form-group">
                                    <label class="form-label">Địa chỉ</label>
                                    <input type="text" id="c_address" name="address" class="form-control">
                                </div>

                                <!-- NEW: loại xe -->
                                <div class="form-group">
                                    <label class="form-label">Loại xe chính</label>
                                    <select id="c_vehicleType" name="vehicleType"
                                        class="form-control modal-select-styled">
                                        <option value="">-- Chọn loại xe (tuỳ chọn) --</option>
                                        <option value="Sedan">Sedan</option>
                                        <option value="SUV">SUV</option>
                                        <option value="Hatchback">Hatchback</option>
                                        <option value="EV">EV</option>
                                        <option value="Pickup">Pickup</option>
                                    </select>
                                </div>

                                <!-- NEW: số xe -->
                                <div class="form-group">
                                    <label class="form-label">Số xe</label>
                                    <input type="number" id="c_vehicleCount" name="vehicleCount" class="form-control"
                                        min="0" value="0">
                                </div>

                                <div class="modal-footer-actions">
                                    <button type="button" class="btn" id="customerCancelBtn">Huỷ</button>
                                    <button type="submit" class="btn btn-primary">Lưu</button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Customer profile modal skeleton (ẩn, dùng khi có dữ liệu) -->
                <div id="customerProfileModal" class="modal modal-hidden">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3>Profile khách hàng</h3>
                            <span class="modal-close" id="modalClose">&times;</span>
                        </div>
                        <div class="modal-body">
                            <p class="modal-body-text">Thông tin sẽ load từ DB.</p>
                        </div>
                    </div>
                </div>
            </div>
        </main>

    </div>

    <script>
        // Sidebar resize script (giống vehicles.html)
        document.addEventListener('DOMContentLoaded', function () {
            const sidebar = document.getElementById('sidebar');
            const contentWrapper = document.getElementById('contentWrapper');
            const resizer = document.getElementById('sidebarResizer');

            let isResizing = false;
            let startX = 0;
            let startWidth = 0;

            const minWidth = 200;
            const maxWidth = 400;

            resizer.addEventListener('mousedown', function (e) {
                isResizing = true;
                startX = e.clientX;
                startWidth = parseInt(document.defaultView.getComputedStyle(sidebar).width, 10);
                document.body.style.cursor = 'ew-resize';
                document.body.style.userSelect = 'none';
                e.preventDefault();
            });

            document.addEventListener('mousemove', function (e) {
                if (!isResizing) return;
                const width = startWidth + e.clientX - startX;
                if (width >= minWidth && width <= maxWidth) {
                    sidebar.style.width = width + 'px';
                    contentWrapper.style.marginLeft = width + 'px';
                }
            });

            document.addEventListener('mouseup', function () {
                if (isResizing) {
                    isResizing = false;
                    document.body.style.cursor = '';
                    document.body.style.userSelect = '';
                }
            });

            // Modal open/close helpers
            const modal = document.getElementById('customerModal');
            const modalClose = document.getElementById('customerModalClose');
            const newCustomerBtn = document.getElementById('newCustomerBtn');
            const cancelBtn = document.getElementById('customerCancelBtn');

            function openCustomerModal() {
                if (modal) {
                    modal.classList.remove('modal-hidden');
                    modal.style.display = 'block';
                }
            }

            function closeCustomerModal() {
                if (modal) {
                    modal.style.display = 'none';
                    modal.classList.add('modal-hidden');
                }
            }

            if (newCustomerBtn) newCustomerBtn.addEventListener('click', openCustomerModal);
            if (modalClose) modalClose.addEventListener('click', closeCustomerModal);
            if (cancelBtn) cancelBtn.addEventListener('click', closeCustomerModal);
            window.addEventListener('click', (e) => { if (e.target === modal) closeCustomerModal(); });

            // Legacy function for compatibility
            window.openCustomerPopup = openCustomerModal;

            // Menu group toggle
            const menuGroupToggles = document.querySelectorAll('.menu-group-toggle');
            menuGroupToggles.forEach(toggle => {
                toggle.addEventListener('click', function () {
                    const parentLi = this.parentElement;
                    const isOpen = parentLi.classList.toggle('open');
                    const submenu = this.nextElementSibling;
                    submenu.style.maxHeight = isOpen ? submenu.scrollHeight + 'px' : '0';
                });
            });
        });
    </script>

</body>

</html>