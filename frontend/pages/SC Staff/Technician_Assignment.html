<section class="technician-assignment">
    <div class="app-layout">
        <main class="content-wrapper" id="contentWrapper">

            <div class="main-content-area">
                <!-- Search + Filter -->
                <div class="search-filter-bar">
                    <div class="search-box-wrapper">
                        <i class="fas fa-search search-icon"></i>
                        <input type="text" id="searchBox" class="form-control search-input-with-icon"
                            placeholder="Tìm theo biển số, mã yêu cầu...">
                    </div>
                </div>

                <!-- Filters -->
                <div class="card filter-card">
                    <div class="filter-card-body">
                        <div class="filter-controls">
                            <select id="statusFilter" class="filter-select">
                                <option value="">Tất cả trạng thái</option>
                                <option value="approved" selected>Đã chấp thuận</option>
                                <option value="assigned">Đã phân công</option>
                            </select>
                            <input type="date" id="dateFilter" class="filter-input">
                        </div>
                    </div>
                </div>

                <!-- Danh sách yêu cầu -->
                <div class="card">
                    <div class="card-body-no-padding">
                        <table class="table-zebra table-full-width">
                            <thead>
                                <tr class="table-header-row">
                                    <th class="table-header-cell">Mã Y/C</th>
                                    <th class="table-header-cell">Biển số / VIN</th>
                                    <th class="table-header-cell">Ngày tạo</th>
                                    <th class="table-header-cell">Kỹ thuật viên</th>
                                    <th class="table-header-cell">Thao tác</th>
                                </tr>
                            </thead>
                            <tbody id="claimsTbody">
                                <!-- Placeholder -->
                                <tr id="placeholderRow">
                                    <td colspan="5" class="table-placeholder-cell">
                                        Dữ liệu sẽ được load từ database — chưa có dữ liệu ở môi trường hiện tại.
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="card-footer">
                        <div class="pagination-wrapper">
                            <span class="pagination-info">Hiển thị 0 của 0</span>
                            <div>
                                <button class="pagination-btn">« Trước</button>
                                <button class="btn-primary pagination-btn-active">1</button>
                                <button class="pagination-btn">Sau »</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Modal phân công KTV -->
                <div id="assignModal" class="modal modal-hidden">
                    <div class="modal-content" role="dialog" aria-modal="true" aria-labelledby="assignModalTitle"
                        tabindex="-1">
                        <div class="modal-header">
                            <h3 id="assignModalTitle">Phân công Kỹ thuật viên</h3>
                            <span class="modal-close" id="assignModalClose" role="button"
                                aria-label="Đóng">&times;</span>
                        </div>

                        <form id="assignForm">
                            <div class="modal-body">
                                <p class="modal-body-text">Yêu cầu: <strong id="assignClaimCode">CLM-0001</strong>
                                </p>

                                <div class="form-group">
                                    <label class="form-label">Chọn Kỹ thuật viên</label>
                                    <select id="techSelect" class="form-control modal-select-styled" required>
                                        <option value="">-- Chọn kỹ thuật viên --</option>
                                        <!-- 
											Danh sách kỹ thuật viên sẽ load từ database.
											
											Ví dụ Thymeleaf khi có backend:
											<option th:each="tech : ${technicians}" th:value="${tech.id}" th:text="${tech.fullName}">Nguyễn Văn A</option>
											
											Hoặc dùng JavaScript fetch từ /api/technicians để render options động.
										-->
                                    </select>
                                </div>

                                <div class="form-group">
                                    <label class="form-label">Ghi chú (tuỳ chọn)</label>
                                    <textarea id="assignNote" class="form-control" rows="3"
                                        placeholder="Ghi chú cho kỹ thuật viên..."></textarea>
                                </div>

                                <div class="modal-footer-actions">
                                    <button type="button" class="btn" id="assignCancelBtn">Huỷ</button>
                                    <button type="submit" class="btn btn-primary">Lưu</button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Sidebar resize
            const sidebar = document.getElementById('sidebar');
            const contentWrapper = document.getElementById('contentWrapper');
            const resizer = document.getElementById('sidebarResizer');
            let isResizing = false, startX = 0, startWidth = 0;
            const minWidth = 200, maxWidth = 400;

            resizer.addEventListener('mousedown', (e) => {
                isResizing = true;
                startX = e.clientX;
                startWidth = parseInt(window.getComputedStyle(sidebar).width, 10);
                document.body.style.cursor = 'ew-resize';
                document.body.style.userSelect = 'none';
                e.preventDefault();
            });

            document.addEventListener('mousemove', (e) => {
                if (!isResizing) return;
                const w = startWidth + e.clientX - startX;
                if (w >= minWidth && w <= maxWidth) {
                    sidebar.style.width = w + 'px';
                    contentWrapper.style.marginLeft = w + 'px';
                }
            });

            document.addEventListener('mouseup', () => {
                if (isResizing) {
                    isResizing = false;
                    document.body.style.cursor = '';
                    document.body.style.userSelect = '';
                }
            });

            // Menu group toggle
            document.querySelectorAll('.menu-group-toggle').forEach(btn => {
                btn.addEventListener('click', function () {
                    const li = this.closest('.menu-group');
                    li.classList.toggle('open');
                });
            });

            // Modal handlers
            const assignModal = document.getElementById('assignModal');
            const assignModalClose = document.getElementById('assignModalClose');
            const assignCancelBtn = document.getElementById('assignCancelBtn');

            window.openAssignModal = function (id, code) {
                if (assignModal) {
                    assignModal.classList.remove('modal-hidden');
                    assignModal.style.display = 'block';
                }
                document.body.classList.add('modal-open');
            };

            function closeAssignModal() {
                if (assignModal) {
                    assignModal.style.display = 'none';
                    assignModal.classList.add('modal-hidden');
                    document.body.classList.remove('modal-open');
                }
            }

            if (assignModalClose) assignModalClose.addEventListener('click', closeAssignModal);
            if (assignCancelBtn) assignCancelBtn.addEventListener('click', (e) => {
                e.preventDefault();
                closeAssignModal();
            });

            window.addEventListener('click', (e) => {
                if (e.target === assignModal) closeAssignModal();
            });

            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && assignModal && assignModal.style.display === 'block') {
                    closeAssignModal();
                }
            });
        });
    </script>
</section>
