<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Thông Báo - Hệ Thống Quản Lý SC</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="theme.css" rel="stylesheet">
</head>
<body class="app-layout">
  <!-- ===== SIDEBAR (thay thế block hiện tại) ===== -->
<aside class="sidebar">
  <input type="checkbox" id="open-sidebar" />
  <label for="open-sidebar" class="open-sidebar-btn">
    <i class="bi bi-list"></i>
  </label>

  <div class="sidebar-menu">
    <div class="sidebar-logo">
      <a href="SCStaff.html">
        <span class="logo-text">Hệ Thống Quản Lý SC</span>
      </a>
    </div>

    <ul class="sidebar-nav">
      <li><a href="SCStaff.html">
          <span class="icon"><i class="bi bi-gear-wide-connected"></i></span>
          <span class="label">Quản lý Yêu Cầu</span>
        </a></li>

      <li><a href="warranty.html">
          <span class="icon"><i class="bi bi-tools"></i></span>
          <span class="label">Bảo Hành</span>
        </a></li>

      <li><a href="parts.html">
          <span class="icon"><i class="bi bi-box-seam-fill"></i></span>
          <span class="label">Phụ Tùng</span>
        </a></li>

      <li class="active"><a href="notification.html">
          <span class="icon"><i class="bi bi-bell-fill"></i></span>
          <span class="label">Thông Báo</span>
        </a></li>
    </ul>
  </div>
</aside>
<!-- ===== /SIDEBAR ===== -->

  <main class="main-content">
    <div class="d-flex align-items-center justify-content-between mb-4">
      <div>
        <h1><i class="bi bi-bell-fill me-2 text-danger"></i> Thông Báo</h1>
        <p class="page-description">Danh sách các thông báo mới nhất</p>
      </div>
      <div class="header-search">
        <input id="searchInput" type="text" class="form-control" placeholder="Tìm kiếm thông báo">
        <button id="btnSearch" class="btn btn-primary"><i class="bi bi-search"></i></button>
      </div>
    </div>
    <div class="card">
      <ul id="notificationsList" class="list-notifs"></ul>
    </div>
    <div class="form-actions">
      <button id="btnMarkAll" class="btn btn-outline-primary"><i class="bi bi-check-all"></i> Đánh dấu tất cả</button>
      <button id="btnClearAll" class="btn btn-outline-danger"><i class="bi bi-trash"></i> Xoá tất cả</button>
    </div>
    
  </main>
  <div class="modal fade" id="notifModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Chi tiết thông báo</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Đóng"></button>
        </div>
        <div class="modal-body">
          <p id="modalContent" class="mb-0"></p>
        </div>
        <div class="modal-footer">
          <button class="btn btn-outline-secondary" data-bs-dismiss="modal">Đóng</button>
          <button id="modalMark" class="btn btn-primary"><i class="bi bi-check-lg"></i> Đánh dấu đã đọc</button>
        </div>
      </div>
    </div>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    document.getElementById('year').textContent = new Date().getFullYear();
    const notifList = document.getElementById('notificationsList');
    const modalEl = new bootstrap.Modal(document.getElementById('notifModal'));
    const modalContent = document.getElementById('modalContent');
    let notifications = JSON.parse(localStorage.getItem('notifications')) || [];

    // Render notifications
    function renderNotifications() {
      notifList.innerHTML = '';
      notifications.forEach((notif, index) => {
        const li = document.createElement('li');
        li.classList.add('notif-item');
        li.innerHTML = `
          <div class="notif-left">
            <div class="notif-icon bg-${notif.type === 'danger' ? 'wr' : notif.type === 'success' ? 'part-ok' : 'part-sent'}">
              <i class="bi bi-${notif.type === 'danger' ? 'tools' : notif.type === 'success' ? 'check-circle' : 'truck'}"></i>
            </div>
            <div>
              <div class="notif-title text-${notif.type}">${notif.title}</div>
              <div class="notif-meta">${notif.customer ? `${notif.customer} — ` : ''}${notif.date}</div>
            </div>
          </div>
          <div class="notif-actions">
            <button class="btn btn-sm btn-primary btn-view">Xem</button>
            <button class="btn btn-sm btn-outline-secondary btn-mark" data-index="${index}">Đánh dấu</button>
          </div>
        `;
        notifList.appendChild(li);
      });
      localStorage.setItem('notifications', JSON.stringify(notifications));
    }

    // Handle notification interactions
    notifList.addEventListener('click', (e) => {
      const target = e.target.closest('button');
      if (!target) return;
      const li = target.closest('li');
      const index = parseInt(target.dataset.index);
      const title = li.querySelector('.notif-title').textContent;
      const meta = li.querySelector('.notif-meta').textContent;

      if (target.classList.contains('btn-view')) {
        modalContent.textContent = `${title} — ${meta}.\n\n(Chi tiết mô phỏng...)`;
        modalEl.show();
        target.dataset.index = index;
      } else if (target.classList.contains('btn-mark')) {
        notifications.splice(index, 1);
        localStorage.setItem('notifications', JSON.stringify(notifications));
        li.classList.add('fade-out');
        setTimeout(() => li.remove(), 200);
      }
    });

    // Handle modal mark button
    document.getElementById('modalMark').addEventListener('click', () => {
      const index = parseInt(document.querySelector('.btn-view[data-index]').dataset.index);
      notifications.splice(index, 1);
      localStorage.setItem('notifications', JSON.stringify(notifications));
      modalEl.hide();
      renderNotifications();
    });

    // Handle mark all and clear all
    document.getElementById('btnMarkAll').addEventListener('click', () => {
      if (confirm('Đánh dấu tất cả là đã đọc?')) {
        notifications = [];
        localStorage.setItem('notifications', JSON.stringify(notifications));
        renderNotifications();
      }
    });

    document.getElementById('btnClearAll').addEventListener('click', () => {
      if (confirm('Xoá tất cả thông báo? Hành động này không thể hoàn tác.')) {
        notifications = [];
        localStorage.setItem('notifications', JSON.stringify(notifications));
        renderNotifications();
      }
    });

    // Handle search
    document.getElementById('btnSearch').addEventListener('click', () => {
      const q = document.getElementById('searchInput').value.trim().toLowerCase();
      document.querySelectorAll('#notificationsList li').forEach(li => {
        const text = li.innerText.toLowerCase();
        li.style.display = text.includes(q) ? 'flex' : 'none';
      });
    });

    document.getElementById('searchInput').addEventListener('keypress', (e) => {
      if (e.key === 'Enter') document.getElementById('btnSearch').click();
    });

    // Initialize
    renderNotifications();
  </script>
</body>
</html>
